"use strict";
/*
 * Copyright 2024 Amazon.com, Inc. or its affiliates. All rights reserved.
 *
 * AMAZON PROPRIETARY/CONFIDENTIAL
 *
 * You may not use this file except in compliance with the terms and
 * conditions set forth in the accompanying LICENSE.TXT file.
 *
 * THESE MATERIALS ARE PROVIDED ON AN "AS IS" BASIS. AMAZON SPECIFICALLY
 * DISCLAIMS, WITH RESPECT TO THESE MATERIALS, ALL WARRANTIES, EXPRESS,
 * IMPLIED, OR STATUTORY, INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.KeplerMediaDescriptor = void 0;
// rs_out
// @ts-nocheck
const NativeInterface_1 = require("./turbo-modules/NativeInterface");
const KeplerMediaDescriptorTurboModule_1 = __importDefault(require("./turbo-modules/KeplerMediaDescriptorTurboModule"));
const MediaCapabilitiesImpl_1 = require("./MediaCapabilitiesImpl");
/**
 * The entry point for KMD apis. This class provides apis to query the media capabilities of
 * the device.
 */
class KeplerMediaDescriptor {
    constructor() { }
    /**
     * Query the Media capabilities asynchronously.
     *
     * @param config @type {MediaConfig} which encapsulates all the attributes to be queried
     * querying capabilities.
     *
     * @returns @type {Promise} of @type {MediaCapabilities} containing all the capabilities returned
     * according to the @param config. Empty array if there is an error (input or internal) while querying the device
     * or the device doesn't support the requested  attributes.
     */
    static async queryMediaCapabilities(config) {
        let jsonObjs;
        let isVideo;
        let displayResolution;
        let result = [];
        if (config instanceof NativeInterface_1.VideoDecoderConfig) {
            jsonObjs = KeplerMediaDescriptorTurboModule_1.default.queryVideoDecoderCapabilities(config);
            isVideo = true;
        }
        else if (config instanceof NativeInterface_1.AudioDecoderConfig) {
            jsonObjs = KeplerMediaDescriptorTurboModule_1.default.queryAudioDecoderCapabilities(config);
            isVideo = false;
        }
        else {
            console.error('unknown config type, return empty');
            return new Promise((_, reject) => {
                reject(new TypeError("unknown config type"));
            });
        }
        console.debug('js queryMediaCapabilities: ', jsonObjs);
        jsonObjs?.forEach((obj) => {
            let mediaCaps;
            if (isVideo) {
                mediaCaps = new MediaCapabilitiesImpl_1.VideoDecoderCapabilitiesImpl(obj);
            }
            else {
                mediaCaps = new MediaCapabilitiesImpl_1.AudioDecoderCapabilitiesImpl(obj);
            }
            result.push(mediaCaps);
        });
        console.debug('result length: ', result.length);
        return new Promise((resolve, _) => {
            resolve(result);
        });
    }
    static queryMediaCapabilitiesSync(config) {
        let jsonObjs;
        let isVideo;
        let result = [];
        if (config instanceof NativeInterface_1.VideoDecoderConfig) {
            jsonObjs = KeplerMediaDescriptorTurboModule_1.default.queryVideoDecoderCapabilities(config);
            isVideo = true;
        }
        else if (config instanceof NativeInterface_1.AudioDecoderConfig) {
            jsonObjs = KeplerMediaDescriptorTurboModule_1.default.queryAudioDecoderCapabilities(config);
            isVideo = false;
        }
        else {
            console.error('unknown config type, return empty');
            return result;
        }
        console.debug('js queryMediaCapabilities: ', jsonObjs);
        jsonObjs?.forEach((obj) => {
            let mediaCaps;
            if (isVideo) {
                mediaCaps = new MediaCapabilitiesImpl_1.VideoDecoderCapabilitiesImpl(obj);
            }
            else {
                mediaCaps = new MediaCapabilitiesImpl_1.AudioDecoderCapabilitiesImpl(obj);
            }
            result.push(mediaCaps);
        });
        console.debug('result length: ', result.length);
        return result;
    }
}
exports.KeplerMediaDescriptor = KeplerMediaDescriptor;

/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * Portions of this file are copyright (c) 2023 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * PORTIONS OF THIS FILE ARE AMAZON PROPRIETARY/CONFIDENTIAL.  USE IS SUBJECT TO LICENSE TERMS.
 *
 * Amazon modifications are indicated by [amznmod_* comments].
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
 */

/**
 * Changelog:
 * - Modified AppState to include reconfigure and moduleChange AppStateEvent
 * - Add ModuleStateKepler
 * - Add AppReconfigureReason, ReconfigureReasonData
 * - Add an omni-type to unify AppStateStatus, ModuleStateKepler, ReconfigureReasonData
 * - include currentModuleStates in AppStateStatic
 */

import {NativeEventSubscription} from '../EventEmitter/RCTNativeAppEventEmitter';

// amznmod_react - Modified AppState to include reconfigure and moduleChange AppStateEvent
export type AppStateEventKepler = 'reconfigure' | 'moduleChange';

// amznmod_react - Add ModuleStateKepler
export interface ModuleStateKepler {
  module_name: string;
  module_state: string;
}

// amznmod_react - Add AppReconfigureReason, ReconfigureReasonData
export type AppReconfigureReason = 'homePressed';
export interface ReconfigureReasonData {
  module_name: string;
  reconfigure_reason: AppReconfigureReason;
}

export type AppStateListener = AppStateStatus | ModuleStateKepler[] | ReconfigureReasonData;

/**
 * AppState can tell you if the app is in the foreground or background,
 * and notify you when the state changes.
 *
 * AppState is frequently used to determine the intent and proper behavior
 * when handling push notifications.
 *
 * App State Events
 *      change - This even is received when the app state has changed.
 *      moduleChange [Kepler] - Received when the state of any window module changes
 *      focus [Android] - Received when the app gains focus (the user is interacting with the app).
 *      blur [Android] - Received when the user is not actively interacting with the app.
 *      reconfigure [Kepler] - Received when an application reconfiguration event occurs
 *
 * App States
 *      active - The app is running in the foreground
 *      background - The app is running in the background. The user is either in another app or on the home screen
 *      inactive [iOS] - This is a transition state that currently never happens for typical React Native apps.
 *      unknown [iOS] - Initial value until the current app state is determined
 *      extension [iOS] - The app is running as an app extension
 *
 * For more information, see Apple's documentation: https://developer.apple.com/library/ios/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/TheAppLifeCycle/TheAppLifeCycle.html
 *
 * @see https://reactnative.dev/docs/appstate#app-states
 */
export type AppStateEvent = 'change' | 'memoryWarning' | 'blur' | 'focus' | AppStateEventKepler;
export type AppStateStatus =
  | 'active'
  | 'background'
  | 'inactive'
  | 'unknown'
  | 'extension';

// amznmod_react - Add an omni-type to unify AppStateStatus, ModuleStateKepler, ReconfigureReasonData
export type AppStateChange = AppStateStatus | ModuleStateKepler | ReconfigureReasonData;

export interface AppStateStatic {
  currentState: AppStateStatus;
  isAvailable: boolean;
  // amznmod_react - include currentModuleStates in AppStateStatic
  currentModuleStates: ModuleStateKepler[];

  /**
   * Add a handler to AppState changes by listening to the change event
   * type and providing the handler
   */
  addEventListener(
    type: AppStateEvent,
    listener: (state: AppStateChange) => void,
  ): NativeEventSubscription;
}

export const AppState: AppStateStatic;
export type AppState = AppStateStatic;

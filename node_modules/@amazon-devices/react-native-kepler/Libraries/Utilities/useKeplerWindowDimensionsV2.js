import type {DisplayMetrics} from './NativeDeviceInfo';
import {useContext, useEffect, useState} from 'react';
import {RootTagContext} from "../ReactNative/RootTag";
import NativeDeviceInfo from "./NativeDeviceInfo";

/**
 * @brief A custom hook that returns window dimensions, for a given `didUpdateDimensions` event.
 * It returns the current dimensions and automatically updates them when there is a change.
 *
 * @returns {DisplayMetrics} - Object containing information about window dimensions.
 *      @property {number} width - The width of the window.
 *      @property {number} height - The height of the window.
 *      @property {number} scale - The scaling factor of the window.
 *      @property {number} fontScale - The font scaling factor of the window.
 */
export default function useKeplerWindowDimensionsV2(): DisplayMetrics {

    const rootTag = useContext(RootTagContext);
    const [dimensions, setDimensions] = useState(() => NativeDeviceInfo.getDimensionsV2(rootTag));

    useEffect(() => {
        const handleChange = (newDimensions: DisplayMetrics) => {
            if (dimensions.width !== newDimensions.width || dimensions.height !== newDimensions.height ||
                dimensions.scale !== newDimensions.scale || dimensions.fontScale !== newDimensions.fontScale) {
                setDimensions(newDimensions);
            }
        }

        const subscription = NativeDeviceInfo.addListenerV2(rootTag, 'didUpdateDimensions', handleChange);
        return () => {
            subscription.remove();
        };
    }, [dimensions]);

    return dimensions;
}

/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * Portions of this file are copyright (c) 2021 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * PORTIONS OF THIS FILE ARE AMAZON PROPRIETARY/CONFIDENTIAL.  USE IS SUBJECT TO LICENSE TERMS.
 *
 * Amazon modifications are indicated by [amznmod_* comments].
 * 
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
 * @flow strict-local
 */

/**
 * Sets up global variables typical in most JavaScript environments.
 *
 *   1. Global timers (via `setTimeout` etc).
 *   2. Global console object.
 *   3. Hooks for printing stack traces with source maps.
 *
 * Leaves enough room in the environment for implementing your own:
 *
 *   1. Require system.
 *   2. Bridged modules.
 *
 */

'use strict';

import {setRuntimeConfigProvider} from '../NativeComponent/NativeComponentRegistry';

const start = Date.now();

require('./setUpGlobals');
require('../../src/private/core/setUpDOM');
require('./setUpPerformance');
require('./setUpErrorHandling');
require('./polyfillPromise');
require('./setUpRegeneratorRuntime');
require('./setUpTimers');
require('./setUpXHR');
require('./setUpAlert');
require('./setUpNavigator');
require('./setUpBatchedBridge');
require('./setUpSegmentFetcher');
if (__DEV__) {
  require('./checkNativeVersion');
  require('./setUpDeveloperTools');
  require('../LogBox/LogBox').default.install();
}
require('../ReactNative/AppRegistry');

//amznmod_react - Define runtime config provider to be used in NativeComponentRegistry
//
// If native = true, the named component will be generated from native component attributes.
// If native = false, the named component will be generated by the viewConfig passed into NativeComponentRegistry.get()
// Verify flag is used to compare native vs viewConfig attributes.
const COMPONENT_RUNTIME_CONFIG = {
  'RCTImageView': {native: false, verify: false},
  'RCTView': {native:false, verify: false},
  'RCTTextInlineImage': {native:false, verify: false},
  'RCTSinglelineTextInputView': {native:false, verify: false},
  'RCTMultilineTextInputView': {native:false, verify: false},
  'KeplerTextInput': {native:false, verify: false},
  'ModalHostView': {native:false, verify: false},
  'AndroidTextInput': {native:false, verify: false},
  'KeplerHorizontalScrollContentView': {native:false, verify: false},
  'RCTScrollView': {native:false, verify: false},
  'RCTScrollContentView': {native:false, verify: false},
  'KeplerHorizontalScrollView': {native:false, verify: false},
  'AndroidHorizontalScrollView': {native:false, verify: false},
};

// Matches the default specified in NativeComponentRegistry.get()
const DEFAULT_COMPONENT_RUNTIME_CONFIG = {
  native: true,
  verify: false,
}

function keplerRuntimeConfigProvider(name: string): {
  native: boolean;
  verify: boolean;
} {
  return COMPONENT_RUNTIME_CONFIG[name] ?
    COMPONENT_RUNTIME_CONFIG[name] :
    DEFAULT_COMPONENT_RUNTIME_CONFIG;
};
setRuntimeConfigProvider(keplerRuntimeConfigProvider);
//amznmod_react

const GlobalPerformanceLogger = require('../Utilities/GlobalPerformanceLogger');
// We could just call GlobalPerformanceLogger.markPoint at the top of the file,
// but then we'd be excluding the time it took to require the logger.
// Instead, we just use Date.now and backdate the timestamp.
GlobalPerformanceLogger.markPoint(
  'initializeCore_start',
  GlobalPerformanceLogger.currentTimestamp() - (Date.now() - start),
);
GlobalPerformanceLogger.markPoint('initializeCore_end');
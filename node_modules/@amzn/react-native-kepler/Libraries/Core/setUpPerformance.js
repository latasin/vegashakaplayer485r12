/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * Portions of this file are copyright (c) 2021 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * PORTIONS OF THIS FILE ARE AMAZON PROPRIETARY/CONFIDENTIAL.  USE IS SUBJECT TO LICENSE TERMS.
 *
 * Amazon modifications are indicated by [amznmod_* comments].
 * 
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @flow strict
 * @format
 */

/**
 * CHANGELOG:
 * 1dae422f6 - Implement report fully drawn performance API 
 * fe227e6a2 - Add a new `performance.nowNanoSec` API to global JS runtime. 
 */

import NativePerformance from '../WebPerformance/NativePerformance';
import Performance from '../WebPerformance/Performance';

// In case if the native implementation of the Performance API is available, use it,
// otherwise fall back to the legacy/default one, which only defines 'Performance.now()'
if (NativePerformance) {
  // $FlowExpectedError[cannot-write]
  global.performance = new Performance();
} else {
  if (!global.performance) {
    // $FlowExpectedError[cannot-write]
    global.performance = ({}: {now?: () => number});
  }

  /**
   * Returns a double, measured in milliseconds.
   * https://developer.mozilla.org/en-US/docs/Web/API/Performance/now
   */
  if (typeof global.performance.now !== 'function') {
    // $FlowExpectedError[cannot-write]
    global.performance.now = function () {
      const performanceNow = global.nativePerformanceNow || Date.now;
      return performanceNow();
    };
  }

  //amznmod_react - add custom performance bindings for measurements
  if (typeof global.performance.nowNanoSec !== 'function') {
    global.performance.nowNanoSec = function() {
      const performanceNow = global.nativePerformanceNowNanoSec || Date.now;
      return performanceNow();
    };
  }
   
  if (typeof global.performance.reportFullyDrawn !== 'function') {
    global.performance.reportFullyDrawn = function() {
      const performanceReportFullyDrawn = global.nativePerformanceReportFullyDrawn;
      return performanceReportFullyDrawn();
    };
  }
  //amznmod_react
}

/*
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * Portions of this file are copyright (c) 2022 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * PORTIONS OF THIS FILE ARE AMAZON PROPRIETARY/CONFIDENTIAL.  USE IS SUBJECT TO LICENSE TERMS.
 *
 * Amazon modifications are indicated by [amznmod_* comments].
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

'use strict';

import NativeEventEmitter from '../EventEmitter/NativeEventEmitter';
import Platform from '../Utilities/Platform';
import {type EventSubscription} from '../vendor/emitter/EventEmitter';
// amznmod_react - Import UserInputManager TurboModule
import UserInputManagerTurboModuleSpec from '../UserInputManager/UserInputManagerTurboModuleSpec';

class TVEventHandler {
    __nativeTVNavigationEventListener: ?EventSubscription = null;
    __nativeTVNavigationEventEmitter: ?UserInputManagerTurboModuleSpec = null;

    // amznmod_react - Kepler Support for UserInput events.
    enable(component: ?any, callback: Function): void {
        if (Platform.OS === 'ios' && !UserInputManagerTurboModuleSpec) {
            return;
        }

        this.__nativeTVNavigationEventEmitter = new NativeEventEmitter(
            UserInputManagerTurboModuleSpec,
        );
        this.__nativeTVNavigationEventListener = this.__nativeTVNavigationEventEmitter.addListener(
            'onHWKeyEvent',
            data => {
                if (callback) {
                    callback(component, data);
                }
            },
        );
    }

    disable(): void {
        if (this.__nativeTVNavigationEventListener) {
            this.__nativeTVNavigationEventListener.remove();
            delete this.__nativeTVNavigationEventListener;
        }
        if (this.__nativeTVNavigationEventEmitter) {
            delete this.__nativeTVNavigationEventEmitter;
        }
    }
}

module.exports = TVEventHandler;
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * Portions of this file are copyright (c) 2025 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * PORTIONS OF THIS FILE ARE AMAZON PROPRIETARY/CONFIDENTIAL.  USE IS SUBJECT TO LICENSE TERMS.
 *
 * Amazon modifications are indicated by [amznmod_* comments].
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
 * @flow
 */

import React from 'react';
import { useEffect } from 'react';
import TVEventHandler from './TVEventHandler';
import type { HWEvent } from './TVTypes';
import Platform from '../Utilities/Platform';
import type { EventSubscription } from '../vendor/emitter/EventEmitter';
import { useAddHWEventListenerCallback } from '../UserInputManager/UserInputManager';

// amzn_mod - use root tag based API to register callbacks
const useTVEventHandler = (handleEvent: (evt: HWEvent) => void) => {
    const addHWEventListenerCallback = useAddHWEventListenerCallback();
    useEffect(() => {
      if (Platform.OS === 'kepler') {
        const eventSubscription: EventSubscription = addHWEventListenerCallback(handleEvent);
        return () => {
          eventSubscription.remove();
        };
      } else {
        const handler: TVEventHandler = new TVEventHandler();
        handler.enable(null, function(cmp, evt) {
          handleEvent(evt);
        });
        return () => {
          handler.disable();
        };
      }
    }, [handleEvent]);
};

module.exports = useTVEventHandler;

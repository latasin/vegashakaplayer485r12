/*
 * Copyright (c) 2022 Amazon.com, Inc. or its affiliates. All rights reserved.
 *
 * @format
 * @flow strict-local
 */
/**
 * @deprecated Use the useKeplerWindowDimensionsV2 hook instead
 *
 **/

'use strict';

import Dimensions from './Dimensions';
import {type DisplayMetricsKepler} from './NativeDeviceInfo';
import {useEffect, useState} from 'react';

export default function useKeplerWindowDimensions(): DisplayMetricsKepler {
  const [dimensions, setDimensions] = useState(() => Dimensions.get('windows'));
  useEffect(() => {
    function handleChange({windows}) {
      const len = dimensions.length;
      let didChange = len !== windows.length;

      if (!didChange) {
        for (let i = 0; i < len; i++) {
          if (
            dimensions[i].width !== windows[i].width ||
            dimensions[i].height !== windows[i].height ||
            dimensions[i].scale !== windows[i].scale ||
            dimensions[i].fontScale !== windows[i].fontScale ||
            dimensions[i].moduleName !== windows[i].moduleName
          ) {
            didChange = true;
            break;
          }
        }
      }

      if (didChange) {
        setDimensions(windows);
      }
    }

    Dimensions.addEventListener('change', handleChange);
    // We might have missed an update between calling `get` in render and
    // `addEventListener` in this handler, so we set it here. If there was
    // no change, React will filter out this update as a no-op.
    handleChange({windows: Dimensions.get('windows')});
    return () => {
      Dimensions.removeEventListener('change', handleChange);
    };
  }, [dimensions]);
  return dimensions;
}
